function getImageDataFromImage(e){var t=typeof e=="string"?document.getElementById(e):e,n=document.createElement("canvas");n.width=t.width,n.height=t.height;var r=n.getContext("2d");return r.drawImage(t,0,0),r.getImageData(0,0,n.width,n.height)}define("utils/DomReady",[],function(){"use strict";function u(e){var t;for(t=0;t<e.length;t+=1)e[t](s)}function a(){var e=o;i&&e.length&&(o=[],u(e))}function f(){i||(i=!0,n&&clearInterval(n),a())}function c(e){return i?e(s):o.push(e),c}var e,t,n,r=typeof window!="undefined"&&window.document,i=!r,s=r?document:null,o=[];if(r){if(document.addEventListener)document.addEventListener("DOMContentLoaded",f,!1),window.addEventListener("load",f,!1);else if(window.attachEvent){window.attachEvent("onload",f),t=document.createElement("div");try{e=window.frameElement===null}catch(l){}t.doScroll&&e&&window.external&&(n=setInterval(function(){try{t.doScroll(),f()}catch(e){}},30))}document.readyState==="complete"&&f()}return c.version="2.0.1",c.load=function(e,t,n,r){r.isBuild?n(null):c(n)},c}),define("talktalk/FormOperations",[],function(){function e(){return 0,this}var t=e.prototype;return t.checkForm=function(){$("input, select, textarea").focus(function(e){$(e.currentTarget).removeClass("error")}),this.checkOthers(),$(".your_business_unit").on("change",this.checkOthers.bind(this)),$(".nominee_business_unit").on("change",this.checkOthers.bind(this)),$(".reason").on("input propertychange",this.checkReason.bind(this))},t.checkReason=function(e){var t=$(e.currentTarget).val(),n=300;if(t.length>n){var r=t.substring(0,n);$(e.currentTarget).val(r)}},t.checkOthers=function(){$(".your_business_unit").val()!="Other"?$(".your_business_unit_other").css("display","none"):$(".your_business_unit_other").css("display","block"),$(".nominee_business_unit").val()!="Other"?$(".nominee_business_unit_other").css("display","none"):$(".nominee_business_unit_other").css("display","block")},e}),define("talktalk/GenerateName",[],function(){function e(){return 0,this.duration=7,$(".button-set.generate .generate-name").on("mousedown touchstart",this.start.bind(this)),this}var t=e.prototype;return t.start=function(){this.messages=["Ironing Cape!","Applying Mask!","Engaging Superpowers!"],this.currentMessage=0,$(".button-set.generate .generate-name").hide(),$(".button-set.generate .progress").show(),TweenMax.set(".generate-container .sizzle",{alpha:.4}),TweenMax.to(".generate-container .sizzle",.2,{alpha:.7,yoyo:!0,repeat:-1,ease:Bounce.easeInOut}),this.showNextMessage()},t.showNextMessage=function(){this.currentMessage>=this.messages.length?(TweenMax.to(".button-set.generate .progress",.2,{scale:0,ease:Sine.easeIn,onComplete:this.showShowButton.bind(this)}),TweenMax.to(".generate-container .sizzle",.2,{alpha:0,ease:Circ.easeOut})):($(".button-set.generate .progress .label").text(this.messages[this.currentMessage]),TweenMax.set(".button-set.generate .progress .label",{scale:.95}),TweenMax.to(".button-set.generate .progress .label",this.duration*.33/12,{scale:1,ease:Expo.easeOut,yoyo:!0,repeat:-1}),TweenMax.set(".button-set.generate .progress .bar",{css:{width:"0%"}}),TweenMax.to(".button-set.generate .progress .bar",this.duration*.33,{css:{width:"100%"},ease:Sine.easeInOut,onComplete:this.showNextMessage.bind(this)}),TweenMax.to(".generate-container .normal",this.duration*.33,{css:{height:String(100-(this.currentMessage+1)*32)+"%"},ease:Circ.easeOut}),TweenMax.to(".generate-container .super",this.duration*.33,{css:{height:String((this.currentMessage+1)*32)+"%"},ease:Circ.easeOut}),TweenMax.to(".generate-container .sizzle",this.duration*.33,{css:{top:String(100-(this.currentMessage+1)*32)+"%"},ease:Circ.easeOut}),this.currentMessage++)},t.showShowButton=function(){TweenMax.set(".button-set.generate .button.show",{scale:0}),TweenMax.to(".button-set.generate .button.show",.2,{delay:.3,scale:1,ease:Sine.easeIn}),$(".button-set.generate .progress").hide(),$(".button-set.generate .button.show").css("display","block")},e}),define("talktalk/PollingManager",[],function(){function e(){return this.functionList=[],this.doPoll(),this.pollInterval=setInterval(this.doPoll.bind(this),2e3),this}var t=e.prototype;return t.registerPoll=function(e){var t={id:this.functionList.length,callback:e,active:!0};return this.functionList.push(t),t},t.doPoll=function(){for(var e in this.functionList)this.functionList[e].active==1&&this.functionList[e].callback()},e});var base64={};base64.PADCHAR="=",base64.ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",base64.makeDOMException=function(){var e,t;try{return new DOMException(DOMException.INVALID_CHARACTER_ERR)}catch(t){var n=new Error("DOM Exception 5");return n.code=n.number=5,n.name=n.description="INVALID_CHARACTER_ERR",n.toString=function(){return"Error: "+n.name+": "+n.message},n}},base64.getbyte64=function(e,t){var n=base64.ALPHA.indexOf(e.charAt(t));if(n===-1)throw base64.makeDOMException();return n},base64.decode=function(e){e=""+e;var t=base64.getbyte64,n,r,i,s=e.length;if(s===0)return e;if(s%4!==0)throw base64.makeDOMException();n=0,e.charAt(s-1)===base64.PADCHAR&&(n=1,e.charAt(s-2)===base64.PADCHAR&&(n=2),s-=4);var o=[];for(r=0;r<s;r+=4)i=t(e,r)<<18|t(e,r+1)<<12|t(e,r+2)<<6|t(e,r+3),o.push(String.fromCharCode(i>>16,i>>8&255,i&255));switch(n){case 1:i=t(e,r)<<18|t(e,r+1)<<12|t(e,r+2)<<6,o.push(String.fromCharCode(i>>16,i>>8&255));break;case 2:i=t(e,r)<<18|t(e,r+1)<<12,o.push(String.fromCharCode(i>>16))}return o.join("")},base64.getbyte=function(e,t){var n=e.charCodeAt(t);if(n>255)throw base64.makeDOMException();return n},base64.encode=function(e){if(arguments.length!==1)throw new SyntaxError("Not enough arguments");var t=base64.PADCHAR,n=base64.ALPHA,r=base64.getbyte,i,s,o=[];e=""+e;var u=e.length-e.length%3;if(e.length===0)return e;for(i=0;i<u;i+=3)s=r(e,i)<<16|r(e,i+1)<<8|r(e,i+2),o.push(n.charAt(s>>18)),o.push(n.charAt(s>>12&63)),o.push(n.charAt(s>>6&63)),o.push(n.charAt(s&63));switch(e.length-u){case 1:s=r(e,i)<<16,o.push(n.charAt(s>>18)+n.charAt(s>>12&63)+t+t);break;case 2:s=r(e,i)<<16|r(e,i+1)<<8,o.push(n.charAt(s>>18)+n.charAt(s>>12&63)+n.charAt(s>>6&63)+t)}return o.join("")},window.btoa||(window.btoa=base64.encode),window.atob||(window.atob=base64.decode),define("utils/JPEGEncoderBasic",[],function(){function e(e){function P(e){var t=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99];for(var n=0;n<64;n++){var a=r((t[n]*e+50)/100);a<1?a=1:a>255&&(a=255),i[N[n]]=a}var f=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99];for(var l=0;l<64;l++){var c=r((f[l]*e+50)/100);c<1?c=1:c>255&&(c=255),s[N[l]]=c}var h=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],p=0;for(var d=0;d<8;d++)for(var v=0;v<8;v++)o[p]=1/(i[N[p]]*h[d]*h[v]*8),u[p]=1/(s[N[p]]*h[d]*h[v]*8),p++}function H(e,t){var n=0,r=0,i=new Array;for(var s=1;s<=16;s++){for(var o=1;o<=e[s];o++)i[t[r]]=[],i[t[r]][0]=n,i[t[r]][1]=s,r++,n++;n*=2}return i}function B(){a=H(C,k),f=H(O,M),l=H(L,A),c=H(_,D)}function j(){var e=1,t=2;for(var n=1;n<=15;n++){for(var r=e;r<t;r++)p[32767+r]=n,h[32767+r]=[],h[32767+r][1]=n,h[32767+r][0]=r;for(var i=-(t-1);i<=-e;i++)p[32767+i]=n,h[32767+i]=[],h[32767+i][1]=n,h[32767+i][0]=t-1+i;e<<=1,t<<=1}}function F(){for(var e=0;e<256;e++)x[e]=19595*e,x[e+256>>0]=38470*e,x[e+512>>0]=7471*e+32768,x[e+768>>0]=-11059*e,x[e+1024>>0]=-21709*e,x[e+1280>>0]=32768*e+8421375,x[e+1536>>0]=-27439*e,x[e+1792>>0]=-5329*e}function I(e){var t=e[0],n=e[1]-1;while(n>=0)t&1<<n&&(g|=1<<y),n--,y--,y<0&&(g==255?(q(255),q(0)):q(g),y=7,g=0)}function q(e){m.push(S[e])}function R(e){q(e>>8&255),q(e&255)}function U(e,t){var n,r,i,s,o,u,a,f,l=0,c,h=8,p=64;for(c=0;c<h;++c){n=e[l],r=e[l+1],i=e[l+2],s=e[l+3],o=e[l+4],u=e[l+5],a=e[l+6],f=e[l+7];var v=n+f,m=n-f,g=r+a,y=r-a,b=i+u,w=i-u,E=s+o,S=s-o,x=v+E,T=v-E,N=g+b,C=g-b;e[l]=x+N,e[l+4]=x-N;var k=(C+T)*.707106781;e[l+2]=T+k,e[l+6]=T-k,x=S+w,N=w+y,C=y+m;var L=(x-C)*.382683433,A=.5411961*x+L,O=1.306562965*C+L,M=N*.707106781,_=m+M,D=m-M;e[l+5]=D+A,e[l+3]=D-A,e[l+1]=_+O,e[l+7]=_-O,l+=8}l=0;for(c=0;c<h;++c){n=e[l],r=e[l+8],i=e[l+16],s=e[l+24],o=e[l+32],u=e[l+40],a=e[l+48],f=e[l+56];var P=n+f,H=n-f,B=r+a,j=r-a,F=i+u,I=i-u,q=s+o,R=s-o,U=P+q,z=P-q,W=B+F,X=B-F;e[l]=U+W,e[l+32]=U-W;var V=(X+z)*.707106781;e[l+16]=z+V,e[l+48]=z-V,U=R+I,W=I+j,X=j+H;var $=(U-X)*.382683433,J=.5411961*U+$,K=1.306562965*X+$,Q=W*.707106781,G=H+Q,Y=H-Q;e[l+40]=Y+J,e[l+24]=Y-J,e[l+8]=G+K,e[l+56]=G-K,l++}var Z;for(c=0;c<p;++c)Z=e[c]*t[c],d[c]=Z>0?Z+.5|0:Z-.5|0;return d}function z(){R(65504),R(16),q(74),q(70),q(73),q(70),q(0),q(1),q(1),q(0),R(1),R(1),q(0),q(0)}function W(e,t){R(65472),R(17),q(8),R(t),R(e),q(3),q(1),q(17),q(0),q(2),q(17),q(1),q(3),q(17),q(1)}function X(){R(65499),R(132),q(0);for(var e=0;e<64;e++)q(i[e]);q(1);for(var t=0;t<64;t++)q(s[t])}function V(){R(65476),R(418),q(0);for(var e=0;e<16;e++)q(C[e+1]);for(var t=0;t<=11;t++)q(k[t]);q(16);for(var n=0;n<16;n++)q(L[n+1]);for(var r=0;r<=161;r++)q(A[r]);q(1);for(var i=0;i<16;i++)q(O[i+1]);for(var s=0;s<=11;s++)q(M[s]);q(17);for(var o=0;o<16;o++)q(_[o+1]);for(var u=0;u<=161;u++)q(D[u])}function $(){R(65498),R(12),q(3),q(1),q(0),q(2),q(17),q(3),q(17),q(0),q(63),q(0)}function J(e,t,n,r,i){var s=i[0],o=i[240],u,a=16,f=63,l=64,c=U(e,t);for(var d=0;d<l;++d)v[N[d]]=c[d];var m=v[0]-n;n=v[0],m==0?I(r[0]):(u=32767+m,I(r[p[u]]),I(h[u]));var g=63;for(;g>0&&v[g]==0;g--);if(g==0)return I(s),n;var y=1,b;while(y<=g){var w=y;for(;v[y]==0&&y<=g;++y);var E=y-w;if(E>=a){b=E>>4;for(var S=1;S<=b;++S)I(o);E&=15}u=32767+v[y],I(i[(E<<4)+p[u]]),I(h[u]),y++}return g!=f&&I(s),n}function K(){var e=String.fromCharCode;for(var t=0;t<256;t++)S[t]=e(t)}function Q(e){e<=0&&(e=1),e>100&&(e=100);if(T==e)return;var t=0;e<50?t=Math.floor(5e3/e):t=Math.floor(200-e*2),P(t),T=e,0}function G(){var t=(new Date).getTime();e||(e=50),K(),B(),j(),F(),Q(e);var n=(new Date).getTime()-t;0}var t=this,n=Math.round,r=Math.floor,i=new Array(64),s=new Array(64),o=new Array(64),u=new Array(64),a,f,l,c,h=new Array(65535),p=new Array(65535),d=new Array(64),v=new Array(64),m=[],g=0,y=7,b=new Array(64),w=new Array(64),E=new Array(64),S=new Array(256),x=new Array(2048),T,N=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],C=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],k=[0,1,2,3,4,5,6,7,8,9,10,11],L=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],A=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],O=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],M=[0,1,2,3,4,5,6,7,8,9,10,11],_=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],D=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];return this.encode=function(e,t){var n=(new Date).getTime();t&&Q(t),m=new Array,g=0,y=7,R(65496),z(),X(),W(e.width,e.height),V(),$();var r=0,i=0,s=0;g=0,y=7,this.encode.displayName="_encode_";var h=e.data,p=e.width,d=e.height,v=p*4,S=p*3,T,N=0,C,k,L,A,O,M,_,D;while(N<d){T=0;while(T<v){A=v*N+T,O=A,M=-1,_=0;for(D=0;D<64;D++)_=D>>3,M=(D&7)*4,O=A+_*v+M,N+_>=d&&(O-=v*(N+1+_-d)),T+M>=v&&(O-=T+M-v+4),C=h[O++],k=h[O++],L=h[O++],b[D]=(x[C]+x[k+256>>0]+x[L+512>>0]>>16)-128,w[D]=(x[C+768>>0]+x[k+1024>>0]+x[L+1280>>0]>>16)-128,E[D]=(x[C+1280>>0]+x[k+1536>>0]+x[L+1792>>0]>>16)-128;r=J(b,o,r,a,l),i=J(w,u,i,f,c),s=J(E,u,s,f,c),T+=32}N+=8}if(y>=0){var P=[];P[1]=y+1,P[0]=(1<<y+1)-1,I(P)}R(65497);var H="data:image/jpeg;base64,"+btoa(m.join(""));m=[];var B=(new Date).getTime()-n;return 0,H},G(),this}var t=e.prototype;return e}),define("utils/CanvasUploader",["utils/JPEGEncoderBasic"],function(e){function t(e){return this.baseUrl=e,this.init(),this}var n=t.prototype;return n.uploader=null,n.initialied=!1,n.init=function(){this.uploaderInitialied=!1,0,this.initUploader()},n.initUploader=function(){this.initialised||(this.uploader=new plupload.Uploader({runtimes:"html5, html4",browse_button:"fake-upload",container:document.getElementById("image-uploader"),url:this.baseUrl+"upload/plupload",unique_names:!0,multi_selection:!1,multipart_params:{"final":"true"},init:{BeforeUpload:function(){0},PostInit:function(e){0,this.uploaderInitialied=!0,$(this).trigger("UPLOADER_READY")}.bind(this),FilesAdded:function(){0,this.uploader.start()}.bind(this),UploadProgress:function(e,t){},Error:function(e,t){0},FileUploaded:function(e,t,n){0;var r=JSON.parse(n.response);$(this).trigger("IMAGE_UPLOADED",{url:r.result,post_process_result:r.post_process_result})}.bind(this)}}),this.uploader.init(),this.initialised=!0)},n.uploadBase64=function(e,t){window.CanvasUploader=this,this.uploadImageData(e,t)},n.uploadBase64FromImage=function(e,t){window.CanvasUploader=this,this.uploadImageData(e.src,t)},n.uploadImageData=function(e,t){window.CanvasUploader=this,0;if(window.FileReader&&window.File){var n=new o.File(null,e);n.name="canvas.jpg",0,this.uploader.settings.multipart_params.upload_params=encodeURI(JSON.stringify(t)),this.uploader.addFile(n)}else this.uploadIE(e,encodeURI(JSON.stringify(t)))},n.uploadImageFromCanvas=function(t,n,r){window.CanvasUploader=this;var i=t.getContext("2d"),s=new e(n);0,0;var o=s.encode(i.getImageData(0,0,t.width,t.height));this.uploadImageData(o,r)},n.uploadIE=function(e,t){0,$("#ieUploader").remove();var n=document.createElement("IFRAME");n.setAttribute("id","ieUploader"),n.setAttribute("src",this.baseUrl+"upload/html4?upload_params="+t),$("body").append($(n)),uploadingToIFrame=!0,n.onload=function(){function o(){s+i>r&&(i=r-s);var e=t.substr(s,i);n.contentWindow.addChunk(e),s+=i,s>=r?(uploadingToIFrame=!1,n.contentWindow.transferComplete()):o()}if(!uploadingToIFrame)return;var t=e,r=t.length,i=1e4,s=0;o()}},n.uploadComplete=function(e,t){$("#ieUploader").remove(),$(this).trigger("IMAGE_UPLOADED",{url:e,post_process_result:t})},t}),define("talktalk/ShareFeedManager",["talktalk/PollingManager","utils/CanvasUploader"],function(e,t){function n(){return 0,this.$imageUploadButton=$("#image-uploader"),this.uploaderInitialised=!1,this.imgUrl="",this.uploader=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:document.getElementById("photo-btn"),unique_names:!0,url:window.baseUrl+"upload",multi_selection:!1,container:document.getElementById("image-uploader"),resize:{width:640,height:640},flash_swf_url:window.baseUrl+"assets/plupload2/js/Moxie.swf",silverlight_xap_url:window.baseUrl+"assets/plupload2/js/Moxie.xap",filters:{max_file_size:"10mb",mime_types:[{title:"Image files",extensions:"jpg"}]},init:{PostInit:function(){0}.bind(this),FilesAdded:function(e,t){this.uploader.start(),$("#spinner-container").show()}.bind(this),UploadProgress:function(e,t){0},Error:function(e,t){0,$("#spinner-container").hide()},FileUploaded:function(e,t,n){0,$("#spinner-container").hide(),$("#image-uploader").addClass("hide"),this.imgUrl=t.target_name,$("#browse-container").append("<img width='200px' src='"+window.baseUrl+"uploads/photos/"+this.imgUrl+"'>")}.bind(this)}}),this.feedOpen=!1,this.onResizeBound=this.onResize.bind(this),this.onFeedDataLoadedBound=this.onFeedDataLoaded.bind(this),this.onCountDataLoadedBound=this.onCountDataLoaded.bind(this),this.$shareContainer=$(".share-container").remove(),this.aLongTimeAgo="2010-01-01 00:00:00",this.feedOffset=0,this.feedLimit=10,this.fetchingFeedData=!1,this.moreFeedsAvailable=!0,this.gotFirstCount=!1,this.lastFeedTimestamp=this.aLongTimeAgo,this.lastCountTimestamp=window.lastFeedCountCheck,TweenMax.set(".share-feed-container .share-feed-bar .close",{autoAlpha:0}),this.initResize(),this.initButtons(),this.initPolling(),this.initScrolling(),this.showPane("feed"),this}var r=n.prototype;return r.initPolling=function(){this.newCountPoll=window.ttPollingManager.registerPoll(this.getCountSince.bind(this))},r.initButtons=function(){$(".share-feed-bar").on("mousedown touchstart",this.onTouchBar.bind(this)),$("#share-something-button").on("mousedown touchstart",function(){this.showPane("share")}.bind(this)),$("#refresh-feed-button").on("mousedown touchstart",function(){this.updateFeed(!0)}.bind(this)),$("#do-share-button").on("mousedown touchstart",this.doShare.bind(this)),$("#cancel-share-button").on("mousedown touchstart",function(){this.showPane("feed")}.bind(this))},r.initScrolling=function(){Draggable.create(".feed-display",{type:"scrollTop",edgeResistance:.8,dragClickables:!0,throwProps:!0}),$(".feed-display").on("scroll",this.onScrollFeed.bind(this))},r.onScrollFeed=function(){($(".feed-display").scrollTop() && 0),$(".feed-display").scrollTop()>this.scrollTrigger&&this.fetchingFeedData==0&&this.moreFeedsAvailable==1&&this.updateFeed(!1)},r.getCountSince=function(){this.newCountPoll.active=!1,$.ajax({type:"POST",url:window.baseUrl+"share_feed_controller/getCountSince",data:{since:this.lastCountTimestamp},success:this.onCountDataLoadedBound})},r.onCountDataLoaded=function(e){$(".latest-feed-count").text("("+e+")"),this.newCountPoll.active=!0,this.gotFirstCount==0&&(TweenMax.set(".share-feed-container",{autoAlpha:1}),TweenMax.to(".share-feed-container",.3,{y:0,ease:Sine.easeIn}),this.gotFirstCount=!0)},r.updateFeed=function(e){this.fullRefresh=e,this.fetchingFeedData=!0,0,this.fullRefresh?TweenMax.to(".feed-display",.1,{autoAlpha:0,ease:Sine.easeIn,onComplete:this.getFeedUpdate.bind(this)}):this.getFeedUpdate()},r.getFeedUpdate=function(){this.fullRefresh==1?($(".feed-display .feed-harness").empty(),this.feedOffset=0,this.moreFeedsAvailable=!0,this.lastFeedTimestamp=this.aLongTimeAgo):this.feedOffset+=this.feedLimit;var e={limit:this.feedLimit,offset:this.feedOffset,from:this.fullRefresh==1?"2020-01-01 00:00:00":this.lastFeedTimestamp};0,$.ajax({type:"POST",dataType:"json",url:window.baseUrl+"share_feed_controller/getShareFeed",data:e,success:this.onFeedDataLoadedBound})},r.onFeedDataLoaded=function(e){0;if(e.length>0){for(var t=0;t<e.length;++t){var n=this.$shareContainer.clone();e[t].is_announcer==1&&n.addClass("announcer"),n.find(".message").text(e[t].message),n.find(".hero-name").text(e[t].hero_name),n.find(".first-name").text(e[t].first_name),n.find(".last-name").text(e[t].last_name),e[t].image!=""?n.find(".post-image").attr("src",window.baseUrl+"uploads/photos/"+e[t].image):$(".image",n).remove(),$(".feed-display .feed-harness").append(n),n=null}TweenMax.to(".feed-display",.1,{autoAlpha:1,ease:Sine.easeIn}),this.lastFeedTimestamp=e[e.length-1].timestamp,this.fullRefresh==1&&this.resetLastCountTimestamp(e[0].timestamp),TweenMax.delayedCall(2,this.allowFetchFeedData.bind(this))}else this.moreFeedsAvailable=!1},r.resetLastCountTimestamp=function(e){this.lastCountTimestamp=e,$.ajax({type:"POST",url:window.baseUrl+"share_feed_controller/setLastFeedCountCheck",data:{timestamp:e}})},r.allowFetchFeedData=function(){this.fetchingFeedData=!1,$(window).resize()},r.doShare=function(e){var t={message:$(".message-text").val(),image:this.imgUrl};this.imgUrl="",$.ajax({type:"POST",data:t,url:window.baseUrl+"share_feed_controller/share",success:this.onShareDone.bind(this)})},r.onShareDone=function(e){e=="success"&&(this.updateFeed(!0),this.showPane("feed"),$(".message-text").val(""))},r.showPane=function(e){e=="feed"&&($("#image-uploader").removeClass("hide"),$("#browse-container>img").remove()),this.currentPane!="#"+e+"-pane"&&(this.currentPane!=null&&TweenMax.to(this.currentPane,.2,{autoAlpha:0,ease:Sine.easeIn,onComplete:this.hidePane.bind(this),onCompleteParams:[this.currentPane]}),this.currentPane="#"+e+"-pane",TweenMax.delayedCall(.1,this.showCurrentPane.bind(this)))},r.showCurrentPane=function(){$(this.currentPane).css("display","block"),TweenMax.to(this.currentPane,.1,{autoAlpha:1,ease:Sine.easeIn}),this.uploaderInitialised==0&&(this.uploaderInitialised=!0,this.uploader.init())},r.hidePane=function(e){$(e).css("display","none")},r.onTouchBar=function(e){this.feedOpen==1?(this.feedOpen=!1,$(".wrapper").css("display","block"),$("body").prepend(this.$imageUploadButton),TweenMax.to(".share-feed-container",.5,{css:{top:this.barTopClosed},ease:Sine.easeInOut,onComplete:function(){$(".feed-display .feed-harness").empty()}}),TweenMax.to(".share-feed-container .share-feed-bar .open-close",.2,{delay:.2,autoAlpha:1,ease:Sine.easeOut}),TweenMax.to(".share-feed-container .share-feed-bar .close",.1,{autoAlpha:0,ease:Sine.easeIn})):(this.feedOpen=!0,this.showPane("feed"),this.updateFeed(!0),$("#browse-container").append(this.$imageUploadButton),TweenMax.to(".share-feed-container",.2,{css:{top:this.barTopOpen},ease:Sine.easeOut,onComplete:function(){$(".wrapper").css("display","none"),$(window).resize()}}),TweenMax.to(".share-feed-container .share-feed-bar .open-close",.2,{autoAlpha:0,ease:Sine.easeOut}),TweenMax.to(".share-feed-container .share-feed-bar .close",.2,{autoAlpha:1,ease:Sine.easeIn}))},r.initResize=function(){TweenMax.set(".share-feed-container",{y:$(".share-feed-bar").outerHeight()}),$(window).on("resize",this.onResizeBound),$(window).resize()},r.onResize=function(e){$("html").hasClass("lt-ie9")&&(window.innerWidth=$(window).innerWidth(),window.innerHeight=$(window).innerHeight()),$(".share-feed-container").width(window.innerWidth-this.getMargin()*2),$(".share-feed-container").width(window.innerWidth-this.getMargin()*2),this.barTopOpen=this.getMargin()+(window.innerWidth<=640?8:10),this.barTopClosed=window.innerHeight-this.getMargin()-$(".share-feed-bar").outerHeight(),this.feedOpen==0?$(".share-feed-container").css("top",this.barTopClosed):$(".share-feed-container").css("top",this.barTopOpen),$(".feed-display").height(window.innerHeight-$(".feed-display").offset().top-this.getMargin()),$("#share-pane").height(window.innerHeight-$("#share-pane").offset().top-this.getMargin()),this.scrollTrigger=$(".feed-harness").height()-$(".feed-display").height(),$("#spinner-container").height(window.innerHeight),$(".spinner").height(window.innerHeight)},r.getMargin=function(){return window.innerWidth<=640?10:20},n}),define("talktalk/MainMenuManager",["talktalk/PollingManager"],function(e){function t(){return 0,this.initPolling(),this}var n=t.prototype;return n.initPolling=function(){this.contribueButtonPoll=window.ttPollingManager.registerPoll(this.checkContributeButton.bind(this))},n.checkContributeButton=function(){this.contribueButtonPoll.active=!1,$.ajax({type:"GET",url:"contribute/checkContributeStatus",success:this.onContributeStatus.bind(this)})},n.onContributeStatus=function(e){e=="true"?$("#contribute-button").css("display","inline-block"):$("#contribute-button").css("display","none"),this.contribueButtonPoll.active=!0},t}),define("talktalk/ContributePoll",[],function(){function e(e){return this.showingError=e,this.contributePoll=window.ttPollingManager.registerPoll(this.checkContribute.bind(this)),this}var t=e.prototype;return t.checkContribute=function(){this.contributePoll.active=!1,$.ajax({type:"GET",url:"/contribute/checkContributeStatus",success:this.onContributeStatus.bind(this)})},t.onContributeStatus=function(e){0,e=="false"?this.showingError==0&&(window.location="/contribute"):this.showingError==1&&(window.location="/contribute"),this.contributePoll.active=!0},e}),define("talktalk/admin/AdminSmartChoice",[],function(){function e(){return 0,this.scriptTemplate='<div class="script-result"><h2>Table 1 Script 1</h2><p class="script-copy">This is the script</p></div>',this.onDataRecievedBound=this.onDataRecieved.bind(this),$(".prev").on("touchstart mousedown",this.onPrevClicked.bind(this)),$(".next").on("touchstart mousedown",this.onNextClicked.bind(this)),$("#groupSelect").change(this.onGroupChanged.bind(this)),this.showScripts($("#groupSelect").val()),this}var t=e.prototype;return t.enableInput=function(){$("#groupSelect").attr("disabled",!1)},t.disableInput=function(){$("#groupSelect").attr("disabled","disabled")},t.showScripts=function(e){this.disableInput(),$.ajax({type:"POST",url:window.BASE_URL+"admin/smart_choice/getScripts",data:{group_id:e},success:this.onDataRecievedBound}),0},t.onDataRecieved=function(e){this.enableInput(),0,$(".results").empty();if(e==null)$(".results").text("This table has not submitted a script");else{e.length>1&&$(".results").append("<h1>"+e.length+" Scripts for "+e[0].table_name+":</h1>");for(var t=0;t<e.length;++t)$next=$(this.scriptTemplate),$("h2",$next).text("Table: "+e[t].table_name+" - Script "+(t+1)),$(".script-copy",$next).html(e[t].script),$(".results").append($next)}},t.onPrevClicked=function(e){location=window.CURRENT_URL+"?current="+(parseInt($("#groupSelect").val(),10)-1)},t.onNextClicked=function(e){location=window.CURRENT_URL+"?current="+(parseInt($("#groupSelect").val(),10)+1)},t.onGroupChanged=function(e){this.showScripts($("#groupSelect").val())},e}),define("talktalk/admin/AdminConsumerRevolution",[],function(){function e(){return 0,this.onPledgesReceivedBound=this.onPledgesReceived.bind(this),this.showMessageBound=this.showMessage.bind(this),this.hideMessageBound=this.hideMessage.bind(this),this.killMessageBound=this.killMessage.bind(this),this.setStatusBound=this.setStatus.bind(this),this.onCountsDataLoadedBound=this.onCountsDataLoaded.bind(this),this.$pledgeHarness=$(".pledge-harness").remove(),this.refresh(),this.countsPoll=window.ttPollingManager.registerPoll(this.getCounts.bind(this)),$("a.refresh-button").on("mousedown touchstart",this.refresh.bind(this)),this}var t=e.prototype;return t.refresh=function(){this.getUnsortedPledgesSince("")},t.getUnsortedPledgesSince=function(e){$(".pledges-list").empty(),$.ajax({type:"GET",url:window.BASE_URL+"admin/consumer_revolution/getUnsortedPledgesSince/"+e,success:this.onPledgesReceivedBound})},t.onPledgesReceived=function(e){this.populatePledges(e)},t.populatePledges=function(e){for(var t in e){var n=this.$pledgeHarness.clone();n.find(".message").text(e[t].pledge),n.find(".heroName").text(e[t].hero_name),n.find(".realName").text(e[t].first_name+" "+e[t].last_name),n.attr("data-id",e[t].id),n.find("a.show-button").on("mousedown touchstart",this.showMessageBound),n.find("a.hide-button").on("mousedown touchstart",this.hideMessageBound),$(".pledges-list").append(n),n.css("display","block"),n=null}},t.showMessage=function(e){var t=$(e.currentTarget).closest(".pledge-harness");this.setStatusBound(t.attr("data-id"),2)},t.hideMessage=function(e){var t=$(e.currentTarget).closest(".pledge-harness");this.setStatusBound(t.attr("data-id"),1)},t.setStatus=function(e,t){$.ajax({type:"POST",url:window.BASE_URL+"admin/consumer_revolution/setPledgeStatus",data:{id:e,status:t},success:this.killMessageBound})},t.killMessage=function(e){var t=".pledge-harness[data-id="+e+"]";TweenMax.to(t,.2,{alpha:0,ease:Sine.easeOut,onComplete:function(e){setTimeout(function(e){$(e).css("display","none")},300,e)},onCompleteParams:[t]})},t.getCounts=function(){this.countsPoll.active=!1,$.ajax({type:"GET",url:window.BASE_URL+"admin/consumer_revolution/getPledgeCounts",success:this.onCountsDataLoadedBound})},t.onCountsDataLoaded=function(e){$(".unsorted-count").text(e.unsorted),$(".hidden-count").text(e.hidden),$(".shown-count").text(e.shown),$("h1 .team-name").text(e.team.team_name+" Team"),$("h1 .team-name").css("color",e.team.team_colour),this.countsPoll.active=!0},e}),define("talktalk/admin/AdminFibre",[],function(){function e(){return 0,this.onCountsDataLoadedBound=this.onCountsDataLoaded.bind(this),this.countsPoll=window.ttPollingManager.registerPoll(this.getCounts.bind(this)),this}var t=e.prototype;return t.getCounts=function(){this.countsPoll.active=!1,$.ajax({type:"GET",url:window.BASE_URL+"admin/power_of_fibre/getCounts",success:this.onCountsDataLoadedBound})},t.onCountsDataLoaded=function(e){$(".perc-answered").text(Math.round(e*100)+"%"),this.countsPoll.active=!0},e}),define("talktalk/admin/AdminZoneManager",[],function(){function e(){return 0,this.onDataLoadedBound=this.onDataLoaded.bind(this),this.countsPoll=window.ttPollingManager.registerPoll(this.checkActivityStatus.bind(this)),this}var t=e.prototype;return t.checkActivityStatus=function(){this.countsPoll.active=!1,$.ajax({type:"GET",url:window.BASE_URL+"admin/zone/getActivityStatus/"+window.activityName,success:this.onDataLoadedBound})},t.onDataLoaded=function(e){0,e!=window.activityStatus&&location.reload(),this.countsPoll.active=!0},e}),define("talktalk/PasswordForm",[],function(){function e(){return this.init(),this}var t=e.prototype;return t.init=function(){0,this.onPasswordResponseBound=this.onPasswordResponse.bind(this),this.onSubmitBound=this.onSubmit.bind(this),this.enableSubmit()},t.enableSubmit=function(){$("#submit").on("mousedown touchstart",this.onSubmitBound)},t.disableSubmit=function(){$("#submit").off("mousedown touchstart",this.onSubmitBound)},t.getEmailContents=function(){return $("#email").val().toLowerCase()},t.validateEmail=function(e){var t=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return t.test(e)},t.onSubmit=function(){var e=this.getEmailContents();if(this.validateEmail(e)===!1||e===""||e===$("#email").attr("placeholder").toLowerCase())return $("#invalid-email").hide(),$("#invalid-email").fadeIn(),!1;$("#input").hide(),$("#sending").fadeIn(),0,this.disableSubmit(),$.ajax({type:"POST",url:baseUrl+"password/send",data:{email:this.getEmailContents()},success:this.onPasswordResponseBound})},t.onPasswordResponse=function(){$("#sending").hide(),$("#thanks").fadeIn()},e}),define("talktalk/FibreRadioSet",[],function(){function e(e){return 0,this.clicked=null,this.initSet(e),this}var t=e.prototype;return t.initSet=function(e){this.id=e.attr("data-id"),this.$radios=e.find(".button"),this.$radios.on("mousedown touchstart",this.onRadioClicked.bind(this))},t.onRadioClicked=function(e){this.clicked=$(e.currentTarget).attr("data-id"),this.$radios.removeClass("chosen"),$.each(this.$radios,this.setButtonStates.bind(this))},t.setButtonStates=function(e,t){$(t).attr("data-id")==this.clicked&&$(t).addClass("chosen")},e}),define("talktalk/FibreQuestions",["talktalk/FibreRadioSet"],function(e){function t(){return 0,this.initRadios(),$("#submit-button").on("mousedown touchstart",this.onClickSubmit.bind(this)),this}var n=t.prototype;return n.initRadios=function(){this.$radioSets=$(".button-set.answers-radio"),this.radioSets=[];for(var t=0;t<this.$radioSets.length;++t){var n=new e(this.$radioSets.eq(t));this.radioSets.push(n)}},n.onClickSubmit=function(){var e=!0,t=[];for(var n in this.radioSets){var r=this.radioSets[n].clicked;t[n]={id:this.radioSets[n].id,answer:r},r==null&&(e=!1)}e==1?$.ajax({type:"POST",url:"contribute/submitFibreAnswers",data:{answers:t},success:this.onAnswersSubmitted.bind(this)}):$(".please-check").css("display","block")},n.onAnswersSubmitted=function(e){0,window.location=window.baseUrl+"contribute/s/thanks"},t}),define("talktalk/AppManager",["talktalk/FormOperations","talktalk/GenerateName","talktalk/ShareFeedManager","talktalk/PollingManager","talktalk/MainMenuManager","talktalk/ContributePoll","talktalk/admin/AdminSmartChoice","talktalk/admin/AdminConsumerRevolution","talktalk/admin/AdminFibre","talktalk/admin/AdminZoneManager","talktalk/PasswordForm","talktalk/FibreQuestions"],function(e,t,n,r,i,s,o,u,a,f,l,c){function h(){return 0,$(window).scrollTop(0),this.initResize(),this.animateIn(),window.ttPollingManager=new r,$(".share-feed-container").length>0&&this.initShareFeed(),this}var p=h.prototype;return p.animateIn=function(){TweenMax.set(".animate",{scale:.7,autoAlpha:0}),TweenMax.staggerTo(".animate",.1,{scale:1,autoAlpha:1,ease:Sine.easeIn},.05)},p.initResize=function(){this.onResizeBound=this.onResize.bind(this),$(window).on("resize",this.onResizeBound),$(window).resize()},p.onResize=function(e){$("html").hasClass("lt-ie9")&&(window.innerWidth=$(window).innerWidth(),window.innerHeight=$(window).innerHeight())},p.getMargin=function(){return window.innerWidth<=640?10:20},p.initShareFeed=function(){this.shareFeedManager=new n},p.initMainMenu=function(){this.mainMenuManager=new i},p.initContributePoll=function(e){this.contributePoll=new s(e)},p.initActivity=function(e,t){0},p.initPasswordForm=function(){this.passwordForm=new l},p.initFibreQuestions=function(){this.fibreQuestions=new c},p.initAdmin=function(e){switch(e){case"smart_choice":this.adminManager=new o;break;case"consumer_revolution":this.adminManager=new u;break;case"power_of_fibre":this.adminManager=new a;break;case"zone_manager":this.adminManager=new f}},h}),requirejs.config({baseUrl:"/assets/js/src/",paths:{},generateSourceMaps:!1,preserveLicenseComments:!1,useStrict:!0,urlArgs:"bust="+(new Date).getTime()}),require([]),require(["utils/DomReady","talktalk/AppManager"],function(e,t){e(function(){window.talkTalkApp=new t})}),define("Init",function(){});