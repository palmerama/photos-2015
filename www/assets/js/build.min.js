define("utils/DomReady",[],function(){"use strict";function u(e){var t;for(t=0;t<e.length;t+=1)e[t](s)}function a(){var e=o;i&&e.length&&(o=[],u(e))}function f(){i||(i=!0,n&&clearInterval(n),a())}function c(e){return i?e(s):o.push(e),c}var e,t,n,r=typeof window!="undefined"&&window.document,i=!r,s=r?document:null,o=[];if(r){if(document.addEventListener)document.addEventListener("DOMContentLoaded",f,!1),window.addEventListener("load",f,!1);else if(window.attachEvent){window.attachEvent("onload",f),t=document.createElement("div");try{e=window.frameElement===null}catch(l){}t.doScroll&&e&&window.external&&(n=setInterval(function(){try{t.doScroll(),f()}catch(e){}},30))}document.readyState==="complete"&&f()}return c.version="2.0.1",c.load=function(e,t,n,r){r.isBuild?n(null):c(n)},c}),define("project/ImageManager",[],function(){function e(){0,this.sizeStages=[300,500,1e3,2e3,3e3,4e3]}var t=e.prototype;return t.checkImageSize=function(e,t){t=t||null;var n=$(window).scrollTop(),r=e.offset().top,i=e.offset().top+e.innerHeight(),s=r>=n&&r<n+window.innerHeight,o=i>n&&i<n+window.innerHeight;(e.attr("data-id") && 0);if(s||o)if(e.attr("data-id")!=""&&e.attr("data-ratio")!=""){var u=e.innerWidth()*window.devicePixelRatio,a=e.innerHeight()*window.devicePixelRatio,f=this.sizeStages[0];this.findCorrectImageSize(e,u,a,t)}},t.findCorrectImageSize=function(e,t,n,r){var i,s;if(t>this.sizeStages[this.sizeStages.length-1]||n>this.sizeStages[this.sizeStages.length-1])i=this.sizeStages[this.sizeStages.length-1];else for(var o=0;o<this.sizeStages.length;++o)if(parseFloat(e.attr("data-ratio"))<=1){if(t<=this.sizeStages[o]){i=this.sizeStages[o];break}}else if(n<=this.sizeStages[o]){i=this.sizeStages[o];break}s=window.data.baseUrl+"assets/img/photos/"+i+"/"+e.attr("data-id")+".jpg",this.loadImage(e,s,r)},t.loadImage=function(e,t,n){var r=new Image;r.$domEl=e,r.callback=n,r.onload=this.showImage,r.src=t,r.id=e.attr("data-id"),r.doFadeIn=e.attr("data-fade-in")=="true",e.attr("data-fade-in","false")},t.showImage=function(){var e=this;if(e.$domEl.attr("data-id")==e.id){e.$domEl.css("background-image","url('"+e.src+"')"),e.$domEl.css("background-size",e.$domEl.hasClass("photo-solo")?"contain":"cover");var t={autoAlpha:1,ease:Sine.easeIn};e.doFadeIn==1&&(TweenMax.set(e.$domEl,{autoAlpha:0,scale:e.$domEl.hasClass("photo-solo")?.97:1}),t.scale=1),TweenMax.to(e.$domEl,e.$domEl.hasClass("photo-solo")?.4:.2,t),e.callback!=null&&e.callback()}else 0},e}),define("project/AdminManager",[],function(){function e(){0,$("a.shuffle-button").on("click",this.shuffle.bind(this)),$("a.save-button").on("click",this.saveChanges.bind(this)),$("body.admin a.photo").on("click",this.onPhotoClicked.bind(this))}var t=e.prototype;return t.shuffle=function(e){$.ajax({type:"GET",url:window.data.baseUrl+"data/reOrderAlbum/"+window.data.albumTitle,success:this.reloadPage.bind(this)})},t.reOrderAlbumNoShuffle=function(e){$.ajax({type:"GET",url:window.data.baseUrl+"data/reOrderAlbum/"+window.data.albumTitle+"/0",success:this.reloadPage.bind(this)})},t.onPhotoClicked=function(e){this.showSaveButton(),$(e.target).hasClass("full-width")?this.toggleFullWidth(e):this.toggleUsed(e)},t.toggleFullWidth=function(e){$domEl=$(e.currentTarget).find(".full-width"),$domEl.hasClass("selected")?$domEl.removeClass("selected"):$domEl.addClass("selected")},t.toggleUsed=function(e){$domEl=$(e.currentTarget).find(".cell"),$domEl.hasClass("selected")?$domEl.removeClass("selected"):$domEl.addClass("selected")},t.showSaveButton=function(){$(".shuffle-button").css("display","none"),$(".save-button").css("display","block")},t.saveChanges=function(){this.saveData={used:[],unused:[],full_width:[],not_full_width:[],album_title:$(".nav-bar .album").text()},0;var e=$(".wrapper a.photo");e.each(this.buildUsedList.bind(this)),e.each(this.buildFullWidthList.bind(this)),$unusedPhotos=$(".unused-photos a.photo"),$unusedPhotos.each(this.buildUsedList.bind(this)),$.ajax({type:"POST",data:this.saveData,url:window.data.baseUrl+"data/setPhotos",success:this.reOrderAlbumNoShuffle.bind(this)})},t.buildFullWidthList=function(e,t){$(t).find(".full-width").hasClass("selected")?this.saveData.full_width.push($(t).data("id")):this.saveData.not_full_width.push($(t).data("id"))},t.buildUsedList=function(e,t){$(t).find(".cell").hasClass("selected")?this.saveData.unused.push($(t).data("id")):this.saveData.used.push($(t).data("id"))},t.reloadPage=function(){window.location=window.data.baseUrl+"album/"+window.data.albumTitle+"/admin"},t.onResize=function(e){$(".unused-photos .photo").each(this.setPhotoHeight.bind(this)),$(".unused-photos").height($(".admin-bar").innerHeight()-$(".unused-photos").offset().top-$(".controls").outerHeight()-$(".nav-bar").innerHeight())},t.setPhotoHeight=function(e,t){$(t).height($(t).innerWidth()*$(t).data("ratio"))},e}),define("project/AlbumManager",[],function(){function e(){0,$("a.photo").on("click",this.onPhotoClicked.bind(this)),this.prepStorage()}var t=e.prototype;return t.onPhotoClicked=function(e){TweenMax.set(e.currentTarget,{alpha:.3,ease:Sine.easeIn}),sessionStorage["ap_"+window.data.albumTitle]=$(window).scrollTop(),window.location=window.data.baseUrl+"photo/"+window.data.albumTitle+"/"+$(e.currentTarget).attr("data-id")},t.prepStorage=function(){sessionStorage["ap_"+window.data.albumTitle]!=undefined&&setTimeout(function(){$(window).scrollTop(parseInt(sessionStorage["ap_"+window.data.albumTitle]))},10)},e}),define("project/PhotoManager",[],function(){function e(e){0,this.imageManager=e,this.updatePhotoBound=this.updatePhoto.bind(this),this.hammertime=new Hammer($(".photos-harness")[0]),this.hammertime.get("swipe").set({direction:Hammer.DIRECTION_HORIZONTAL,velocity:.1}),this.hammertime.get("pinch").set({enable:!0}),this.hammertime.on("swipeleft swiperight panstart panend panleft panright panmove pinch pinchstart pinchend tap",this.handleHammer.bind(this)),this.pinchScale=1,this.lastDelta={x:0,y:0},this.tapPerc=.25,this.spinnerUrl=window.data.baseUrl+"assets/img/spinner.gif",this.spinnerSize="64px",this.$photoSolo=$(".photo-solo.middle"),this.allowTaps=!0,this.transformPos={x:0,y:0},this.transformOrigin={x:0,y:0},this.$markerTransformOrigin=$(".marker-transform-origin"),this.$markerPosition=$(".marker-position"),this.loadMainPhoto()}var t=e.prototype;return t.loadMainPhoto=function(){$(".photo-solo.middle").eq(0).css("background-image",this.spinnerUrl),$(".photo-solo.middle").eq(0).css("background-size",this.spinnerSize),$(".photo-solo.middle").eq(0).attr("data-id",window.data.main.id),$(".photo-solo.middle").eq(0).attr("data-ratio",window.data.main.ratio),this.imageManager.checkImageSize($(".photo-solo.middle").eq(0),this.loadPrevNext.bind(this)),$(".photo-solo.prev").eq(0).css("background-image",this.spinnerUrl),$(".photo-solo.prev").eq(0).css("background-size",this.spinnerSize),$(".photo-solo.next").eq(0).css("background-image",this.spinnerUrl),$(".photo-solo.next").eq(0).css("background-size",this.spinnerSize),this.resetSharing()},t.resetSharing=function(){this.twitterText="Here's a photo @palmerama took. I quite like it.",this.shareUrl=window.data.baseUrl+"photo/"+window.data.albumTitle+"/"+window.data.main.id,$(".share.fb").attr("href","https://www.facebook.com/sharer.php?u="+encodeURIComponent(this.shareUrl)+"&app_id=824024137711328&display=popup"),$(".share.twitter").attr("href","https://twitter.com/intent/tweet?&url="+this.shareUrl+"&text="+encodeURIComponent(this.twitterText))},t.loadPrevNext=function(){window.data.prev!=null&&($(".photo-solo.prev").eq(0).attr("data-id",window.data.prev.id),$(".photo-solo.prev").eq(0).attr("data-ratio",window.data.prev.ratio),this.imageManager.checkImageSize($(".photo-solo.prev").eq(0))),window.data.next!=null&&($(".photo-solo.next").eq(0).attr("data-id",window.data.next.id),$(".photo-solo.next").eq(0).attr("data-ratio",window.data.next.ratio),this.imageManager.checkImageSize($(".photo-solo.next").eq(0)))},t.handleHammer=function(e){e.preventDefault();var t=null;0;switch(e.type){case"tap":if(this.allowTaps==1){var n=window.innerWidth*this.tapPerc;e.center.x<n&&this.prevAvailable()?(t=window.innerWidth,a=$(".photo-solo.prev").attr("data-id")):e.center.x>window.innerWidth-n&&this.nextAvailable()&&(t=-window.innerWidth,a=$(".photo-solo.next").attr("data-id"))}break;case"panmove":this.pinchScale>1&&(0,this.setPosition(this.lastDelta.x+e.deltaX,this.lastDelta.y+e.deltaY));break;case"pinchstart":0,0,0;var r=this.$photoSolo.offset(),i={x:r.left,y:r.top},s=1/this.pinchScale;0,this.setTransformOrigin({x:(e.center.x-i.x)*s,y:(e.center.y-i.y)*s}),this.setPosition(e.center.x,e.center.y),this.pinchScaleStart=this.pinchScale,this.allowTaps=!1;break;case"pinch":0;var o=4;this.pinchScale=Math.max(1,Math.min(this.pinchScaleStart*e.scale,o)),TweenMax.set(".photo-solo.middle",{scale:this.pinchScale}),this.pinchScale>1&&this.setPosition(e.center.x-this.transformOrigin.x,e.center.y-this.transformOrigin.y);break;case"pinchend":0,$(this).trigger("check_pinched_image_size",[this.$photoSolo,this.$photoSolo.innerWidth()*this.pinchScale*window.devicePixelRatio,this.$photoSolo.innerHeight()*this.pinchScale*window.devicePixelRatio]),this.pinchScale==1&&this.resetTransform();break;case"swiperight":this.prevAvailable()&&(this.photoHarnessXStart=null,t=window.innerWidth,a=$(".photo-solo.prev").attr("data-id"));break;case"swipeleft":this.nextAvailable()&&(this.photoHarnessXStart=null,t=-window.innerWidth,a=$(".photo-solo.next").attr("data-id"));break;case"panstart":this.photoHarnessXStart=$(".photos-harness").css("left");break;case"panend":if(this.photoHarnessXStart!=null){this.photoHarnessXStart=null;var t=null,u=parseInt($(".photos-harness").css("left")),a=null;u<-window.innerWidth/2?(t=-window.innerWidth,a=$(".photo-solo.next").attr("data-id")):u>window.innerWidth/2?(t=window.innerWidth,a=$(".photo-solo.prev").attr("data-id")):t=0}this.pinchScale>1&&(this.lastDelta={x:this.lastDelta.x+e.deltaX,y:this.lastDelta.y+e.deltaY});break;case"panright":this.prevAvailable()&&this.setPan(e.deltaX);break;case"panleft":this.nextAvailable()&&this.setPan(e.deltaX)}if(t!=null&&this.pinchScale==1){var f={x:t,ease:Sine.easeOut};a!=null&&(f.onComplete=this.updatePhotoBound,f.onCompleteParams=[a]),TweenMax.to(".photos-harness",.2,f),this.allowTaps=!1}},t.setPosition=function(e,t){0,this.transformPos={x:e,y:t},TweenMax.set(this.$markerPosition,{x:this.transformPos.x,y:this.transformPos.y}),TweenMax.set(".photo-solo.middle",{x:this.transformPos.x,y:this.transformPos.y})},t.setTransformOrigin=function(e){this.transformOrigin=e,0,TweenMax.set(this.$markerTransformOrigin,{x:this.transformOrigin.x,y:this.transformOrigin.y}),this.applyTransformOrigin()},t.applyTransformOrigin=function(){var e=this.transformOrigin.x+"px "+this.transformOrigin.y+"px";0,TweenMax.set(".photo-solo.middle",{transformOrigin:e})},t.setPan=function(e){this.photoHarnessXStart!=null&&this.pinchScale==1&&TweenMax.set(".photos-harness",{y:0,x:parseInt(this.photoHarnessXStart)+e})},t.prevAvailable=function(){return window.data.main.position>0},t.nextAvailable=function(){return window.data.main.position<window.data.main.count-1},t.resetTransform=function(){this.transformOrigin={x:0,y:0},this.lastDelta={x:0,y:0},TweenMax.to(".photo-solo.middle",.3,{x:0,y:0,transformOrigin:"50% 50%",ease:Sine.easeIn,onComplete:this.setPosition.bind(this),onCompleteParams:[0,0]}),this.allowTaps=!0},t.updatePhoto=function(e){history.replaceState({},"",window.data.baseUrl+"photo/"+window.data.albumTitle+"/"+e),$.ajax({type:"GET",url:window.data.baseUrl+"album/getPhotoDetails/"+window.data.albumTitle+"/"+e,success:this.resetData.bind(this)})},t.resetData=function(e){window.data.main={id:e.photo.id,ratio:e.photo.ratio,position:e.photo.position,count:e.count},e.previous&&(window.data.prev={id:e.previous.photo_id,ratio:e.previous.ratio}),e.next&&(window.data.next={id:e.next.photo_id,ratio:e.next.ratio}),this.pinchScale=1,this.loadMainPhoto(),$(".nav-bar .album .position").text("("+(parseInt(e.photo.position)+1)+"/"+e.count+")"),TweenMax.set(".photos-harness",{x:0}),this.allowTaps=!0},e}),define("project/AppManager",["project/ImageManager","project/AdminManager","project/AlbumManager","project/PhotoManager"],function(e,t,n,r){function i(){0,this.imageManager=new e,window.data.admin==1?this.adminManager=new t:window.data.album==1?this.albumManager=new n:window.data.photo==1&&(this.photoManager=new r(this.imageManager),$(this.photoManager).on("check_pinched_image_size",this.checkPinchedImageSize.bind(this))),this.initOverlay(),this.initResize()}var s=i.prototype;return s.initResize=function(){this.onResizeBound=this.onResize.bind(this),$(window).on("resize",this.onResizeBound),$(window).resize(),$(window).on("scroll",this.onScroll.bind(this))},s.onResize=function(e){$(".row").each(this.setRowHeight.bind(this)),$(".best-fit").each(this.checkImageSize.bind(this)),this.adminManager!=null&&this.adminManager.onResize(e)},s.onScroll=function(e){$(".best-fit").each(this.checkImageSize.bind(this))},s.setRowHeight=function(e,t){$domEl=$(t);var n=$domEl.find(".photo").eq(0);$domEl.height(Math.floor(n.innerWidth()*n.attr("data-ratio")))},s.checkImageSize=function(e,t){$domEl=$(t),$domEl.hasClass("photo-solo")&&$domEl.height(window.innerHeight-50),this.imageManager.checkImageSize($domEl)},s.checkPinchedImageSize=function(e,t,n,r){0,this.imageManager.findCorrectImageSize(t,n,r)},s.initOverlay=function(){this.$overlay=$(".overlay"),$(".nav-bar .name").on("mousedown",function(e){this.$overlay.css("display","table")}.bind(this)),this.$overlay.on("mousedown",function(e){$(e.target).is("a")==0&&this.$overlay.hide()}.bind(this))},i}),requirejs.config({baseUrl:"/assets/js/src/",paths:{},generateSourceMaps:!1,preserveLicenseComments:!1,useStrict:!0,urlArgs:"bust="+(new Date).getTime()}),require([]),require(["utils/DomReady","project/AppManager"],function(e,t){e(function(){window.mainApp=new t})}),define("Init",function(){});